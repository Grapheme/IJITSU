<?
/**
 * TITLE: Главная страница
 * AVAILABLE_ONLY_IN_ADVANCED_MODE
 */
?>
<?
/**
 * Находим колеса для вывода на главной
 */
$wheels = Dic::valuesBySlug('wheels', function($query){
    $tbl1 = $query->join_field('show_on_main', null);
    $query->where($tbl1.'.value', 1);
    $query->orderBy('lft');
});
$wheels = DicVal::extracts($wheels, null, 1, 1);
#Helper::tad($wheels);

/**
 * ..и их ID
 */
$wheels_ids = Dic::makeLists($wheels, null, 'id');
#Helper::tad($wheels_ids);

/**
 * Подгружаем цвета
 */
$wheels_images = Dic::valuesBySlug('wheel_colors', function($query) use ($wheels_ids){

    $tbl1 = $query->join_field('wheel_id', null);
    $query->whereIn($tbl1.'.value', $wheels_ids);

    $query->orderBy('lft');
});
#Helper::smartQueries(1);
$wheels_images = DicVal::extracts($wheels_images, null, 1, 1);
$wheels_images = DicLib::loadImages($wheels_images, 'image');
#Helper::tad($wheels_images);

/**
 * Раскладываем
 */
$temp = array();
foreach ($wheels_images as $img) {
    if (!is_object($img->image))
        continue;
    if (!isset($temp[$img->wheel_id]))
        $temp[$img->wheel_id] = array();
    $temp[$img->wheel_id][] = $img;
}
$wheels_images = $temp;
unset($temp);
#Helper::tad($wheels_images);
?>
@extends(Helper::layout())


@section('page_class')index @stop


@section('style')
@stop


@section('content')

    {{ $page->block('fader') }}

    <div class="content col-2">
        <div class="holder">
            <h1>{{ $page->block('block-1', 'name') }}</h1>

            <div class="col">

                {{ $page->block('block-1') }}

            </div>
        </div>
    </div>
    <div class="content col-3 red-bg">
        <div class="holder">
            <div class="col">
                <div class="icon">
                    <svg version="1.1" id="Слой_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         viewBox="0 0 66 69.8" enable-background="new 0 0 66 69.8" xml:space="preserve">
<path d="M10.3,52.4c-3,0-5.4,2.4-5.4,5.4s2.4,5.4,5.4,5.4s5.4-2.4,5.4-5.4S13.3,52.4,10.3,52.4z M10.3,60.2c-1.3,0-2.4-1.1-2.4-2.4
	s1.1-2.4,2.4-2.4s2.4,1.1,2.4,2.4S11.6,60.2,10.3,60.2z M66,42.3c0-2.1-1-4-2.5-5.2c1.5-1.2,2.5-3.1,2.5-5.2c0-3.5-2.7-6.4-6.1-6.6
	c-0.2,0-0.4,0-0.5,0H43.7c0.6-3.3,1.6-10.2,0.1-15.9C42.1,3.2,37.4,0,33.6,0c-1.3,0-2.4,0.4-3.2,1.1c-2.7,2.3-2.5,4.4-2.2,7.9
	c0.1,1.5,0.3,3.4,0.3,6c0,7.2-5.8,9.8-6.9,10.2c-1.2,0.1-2.3,0.7-3,1.6c-0.7-0.4-1.5-0.7-2.3-0.7H4.3c-2.4,0-4.3,1.9-4.3,4.3v35
	c0,2.4,1.9,4.3,4.3,4.3h11.9c1.1,0,2.1-0.4,2.8-1.1c0.8,0.7,1.7,1.1,2.8,1.1H60c0.5,0,0.9-0.1,1.2-0.3c2.8-0.8,4.8-3.4,4.8-6.4
	c0-2.1-1-4-2.5-5.2c1.5-1.2,2.5-3.1,2.5-5.2s-1-4-2.5-5.2C65.1,46.3,66,44.4,66,42.3z M16.2,66.8H4.3c-0.7,0-1.3-0.6-1.3-1.3v-35
	c0-0.7,0.6-1.3,1.3-1.3h11.9c0.7,0,1.3,0.6,1.3,1.3v35C17.5,66.2,16.9,66.8,16.2,66.8z M59.3,38.6c2,0,3.7,1.7,3.7,3.7
	S61.4,46,59.3,46c-0.8,0-1.5,0.7-1.5,1.5s0.7,1.5,1.5,1.5c2,0,3.7,1.7,3.7,3.7c0,2-1.7,3.7-3.7,3.7c-0.8,0-1.5,0.7-1.5,1.5
	s0.7,1.5,1.5,1.5c2,0,3.7,1.7,3.7,3.7c0,1.7-1.2,3.2-2.8,3.6c-0.1,0-0.2,0.1-0.3,0.1h-38c-0.7,0-1.3-0.6-1.3-1.3v-35v-0.9
	c0-0.7,0.6-1.3,1.3-1.3c0.2,0,0.3,0,0.5-0.1c3.2-1,9.2-5.1,9.2-13.2c0-2.6-0.2-4.6-0.3-6.2c-0.3-3.4-0.3-4.1,1.2-5.4
	C32.6,3.1,33.1,3,33.6,3c2,0,5.8,1.9,7.2,7.1c1.9,6.8-0.5,16.1-0.5,16.2c-0.1,0.4,0,0.9,0.3,1.3s0.7,0.6,1.2,0.6l17.6,0
	c0.1,0,0.1,0,0.2,0c1.9,0.1,3.4,1.7,3.4,3.7c0,2-1.7,3.7-3.7,3.7c-0.8,0-1.5,0.7-1.5,1.5S58.5,38.6,59.3,38.6z"/>
</svg>

                </div>
                <h2>{{ $page->block('block-2_col-1', 'name') }}</h2>

                <p>

                    {{ $page->block('block-2_col-1') }}

                </p>
            </div>
            <div class="col">
                <div class="icon">
                    <svg version="1.1" id="Слой_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         viewBox="0 0 74.8 74.8" enable-background="new 0 0 74.8 74.8" xml:space="preserve">
<g>
    <path d="M37.4,0C16.8,0,0,16.8,0,37.4s16.8,37.4,37.4,37.4C58,74.8,74.8,58,74.8,37.4S58,0,37.4,0z M37.4,71.8
		C18.4,71.8,3,56.3,3,37.4S18.4,3,37.4,3c19,0,34.4,15.4,34.4,34.4S56.3,71.8,37.4,71.8z"/>
    <path d="M37.4,8.2C21.3,8.2,8.2,21.3,8.2,37.4s13.1,29.1,29.1,29.1s29.1-13.1,29.1-29.1S53.4,8.2,37.4,8.2z M37.4,63.5
		c-14.4,0-26.1-11.7-26.1-26.1S23,11.2,37.4,11.2S63.5,23,63.5,37.4S51.8,63.5,37.4,63.5z"/>
    <path d="M42.4,37.4c0-2.8-2.2-5-5-5s-5,2.2-5,5s2.2,5,5,5S42.4,40.1,42.4,37.4z M37.4,39.4c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2
		S38.5,39.4,37.4,39.4z"/>
    <path d="M39.2,32.2c0.2,0.1,0.4,0.1,0.5,0.2c0.2,0.1,0.4,0.1,0.6,0.1c0.4,0,0.8-0.2,1.1-0.4l8-8c0.3-0.3,0.5-0.7,0.4-1.2
		c0-0.4-0.2-0.8-0.6-1.1c-2.7-2.1-6-3.5-9.4-3.9c-0.4-0.1-0.9,0.1-1.2,0.4c-0.3,0.3-0.5,0.7-0.5,1.1v11.3
		C38.2,31.5,38.6,32,39.2,32.2z M41.2,21.3c1.7,0.4,3.3,1.1,4.8,2l-4.8,4.8V21.3z"/>
    <path d="M33.3,32.2c0.3,0.3,0.7,0.4,1.1,0.4c0.2,0,0.4,0,0.6-0.1c0.2-0.1,0.3-0.2,0.5-0.2c0.6-0.2,1-0.8,1-1.4V19.5
		c0-0.4-0.2-0.8-0.5-1.1S35.3,18,34.9,18c-3.4,0.4-6.7,1.8-9.4,3.9c-0.3,0.3-0.6,0.7-0.6,1.1c0,0.4,0.1,0.9,0.4,1.2L33.3,32.2z
		 M33.6,21.3v6.8l-4.8-4.8C30.2,22.4,31.8,21.7,33.6,21.3z"/>
    <path d="M55.2,38.2H43.9c-0.6,0-1.2,0.4-1.4,1c-0.1,0.2-0.1,0.4-0.2,0.5c-0.3,0.6-0.2,1.3,0.3,1.7l8,8c0.3,0.3,0.7,0.4,1.1,0.4
		c0,0,0.1,0,0.1,0c0.4,0,0.8-0.2,1.1-0.6c2.1-2.7,3.5-6,3.9-9.4c0.1-0.4-0.1-0.9-0.4-1.2C56.1,38.4,55.7,38.2,55.2,38.2z M51.4,46
		l-4.8-4.8h6.8C53,42.9,52.4,44.5,51.4,46z"/>
    <path d="M19.5,36.6h11.3c0.6,0,1.2-0.4,1.4-1c0.1-0.2,0.1-0.4,0.2-0.5c0.3-0.6,0.2-1.3-0.3-1.7l-8-8c-0.3-0.3-0.7-0.5-1.2-0.4
		c-0.4,0-0.8,0.2-1.1,0.6c-2.1,2.7-3.5,6-3.9,9.4c-0.1,0.4,0.1,0.9,0.4,1.2C18.7,36.4,19.1,36.6,19.5,36.6z M23.3,28.7l4.8,4.8h-6.8
		C21.7,31.8,22.4,30.2,23.3,28.7z"/>
    <path d="M42.3,35c0.1,0.2,0.2,0.3,0.2,0.5c0.2,0.6,0.8,1,1.4,1h11.3c0.4,0,0.8-0.2,1.1-0.5c0.3-0.3,0.4-0.8,0.4-1.2
		c-0.4-3.4-1.8-6.7-3.9-9.4c-0.3-0.3-0.7-0.6-1.1-0.6c-0.4,0-0.9,0.1-1.2,0.4l-8,8C42.1,33.8,42,34.5,42.3,35z M51.4,28.7
		c0.9,1.5,1.6,3.1,2,4.8h-6.8L51.4,28.7z"/>
    <path d="M41.4,42.6c-0.5-0.5-1.1-0.6-1.7-0.3c-0.2,0.1-0.3,0.2-0.5,0.2c-0.6,0.2-1,0.8-1,1.4v11.3c0,0.4,0.2,0.8,0.5,1.1
		c0.3,0.2,0.6,0.4,1,0.4c0.1,0,0.1,0,0.2,0c3.4-0.4,6.7-1.8,9.4-3.9c0.3-0.3,0.6-0.7,0.6-1.1c0-0.4-0.1-0.9-0.4-1.2L41.4,42.6z
		 M41.2,53.4v-6.8l4.8,4.8C44.5,52.4,42.9,53,41.2,53.4z"/>
    <path d="M35.6,42.5c-0.2-0.1-0.4-0.1-0.5-0.2c-0.6-0.3-1.3-0.2-1.7,0.3l-8,8c-0.3,0.3-0.5,0.7-0.4,1.2c0,0.4,0.2,0.8,0.6,1.1
		c2.7,2.1,6,3.5,9.4,3.9c0.1,0,0.1,0,0.2,0c0.4,0,0.7-0.1,1-0.4c0.3-0.3,0.5-0.7,0.5-1.1V43.9C36.6,43.3,36.2,42.7,35.6,42.5z
		 M33.6,53.4c-1.7-0.4-3.3-1.1-4.8-2l4.8-4.8V53.4z"/>
    <path d="M32.5,39.7c-0.1-0.2-0.2-0.3-0.2-0.5c-0.2-0.6-0.8-1-1.4-1H19.5c-0.4,0-0.8,0.2-1.1,0.5C18.1,39,18,39.5,18,39.9
		c0.4,3.4,1.8,6.7,3.9,9.4c0.3,0.3,0.7,0.6,1.1,0.6c0,0,0.1,0,0.1,0c0.4,0,0.8-0.2,1.1-0.4l8-8C32.6,41,32.7,40.3,32.5,39.7z
		 M23.3,46c-0.9-1.5-1.6-3.1-2-4.8h6.8L23.3,46z"/>
</g>
</svg>

                </div>
                <h2>{{ $page->block('block-2_col-2', 'name') }}</h2>

                <p>

                    {{ $page->block('block-2_col-2') }}

                </p>
            </div>
            <div class="col">
                <div class="icon">
                    <svg version="1.1" id="Слой_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         viewBox="0 0 78.3 74.8" enable-background="new 0 0 78.3 74.8" xml:space="preserve">
<path d="M74,38.5V10c0-5.5-4.5-10-10-10H10C4.5,0,0,4.5,0,10v54.7c0,5.5,4.5,10,10,10h54c5.5,0,10-4.5,10-10V60
	c2.3-0.1,4.2-2,4.2-4.3V42.8C78.3,40.5,76.4,38.6,74,38.5z M3,10c0-3.9,3.1-7,7-7h54c3.9,0,7,3.1,7,7v3.2c0,3-1.9,5.6-4.6,6.6v-9.3
	V6c0-0.8-0.7-1.5-1.5-1.5H10C9.2,4.5,8.5,5.2,8.5,6v4.4V20C5.4,19.3,3,16.5,3,13.2V10z M63.5,8.9h-52V7.5h52V8.9z M11.5,11.9h52v8.3
	h-52V11.9z M64,71.8H10c-3.9,0-7-3.1-7-7V20.3c1.8,1.8,4.3,2.9,7,2.9h54H65c0.2,0,0.4,0,0.6-0.1c2.1-0.3,4-1.3,5.5-2.7v18.2H44.9
	c-2.4,0-4.3,1.9-4.3,4.3v12.9c0,2.4,1.9,4.3,4.3,4.3H71v4.7C71,68.6,67.9,71.8,64,71.8z M75.3,55.7c0,0.7-0.6,1.3-1.3,1.3h-1.4
	c0,0,0,0,0,0s0,0,0,0H44.9c-0.7,0-1.3-0.6-1.3-1.3V42.8c0-0.7,0.6-1.3,1.3-1.3h29c0.7,0,1.3,0.6,1.3,1.3V55.7z M51,44.3
	c-2.8,0-5,2.2-5,5s2.2,5,5,5s5-2.2,5-5S53.7,44.3,51,44.3z M51,51.3c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S52.1,51.3,51,51.3z"/>
</svg>

                </div>
                <h2>{{ $page->block('block-2_col-3', 'name') }}</h2>

                <p>

                    {{ $page->block('block-2_col-3') }}

                </p>
            </div>
        </div>
    </div>
    <div class="content with-teaser">
        <div class="holder">
            <div class="text">

                {{ $page->block('block-3') }}

            </div><img src="{{ Config::get('site.theme_path') }}/images/visual-car-index.jpg" class="visual">
        </div>
    </div>

    @if (is_object($wheels) && $wheels->count()))
    <div class="content col-4">
        <div class="holder">
            <h1>Наши лучшие модели</h1>

            <div class="wrapper"><!--
                @foreach ($wheels as $wheel) 
                    <?
                        if (!@$wheels_images[$wheel->id])
                            continue;
                        $image = $wheels_images[$wheel->id][0];
                        if (!is_object($image->image))
                            continue;
                        $image = $image->image;
                    ?>
                --><a href="{{ URL::route('page', 'catalog') }}#id-{{ $wheel->id }}" class="col">
                    <div style="background-image:url('{{ $image->full() }}');" class="visual"></div>
                    <div class="shadow"></div>
                    <h2>{{ $wheel->name }}</h2>
                </a><!--
                @endforeach
            --></div>
            <a href="/catalog/" class="link">Все модели</a>
        </div>
    </div>
    @endif

@stop


@section('scripts')
@stop